syntax = "proto3";
import "google/protobuf/wrappers.proto";
package com.coralogix.tracing.v1;

message TraceQueryTimeRange {
    google.protobuf.Int64Value start = 1;
    google.protobuf.Int64Value end = 2;
}

message TraceQueryLatency {
    google.protobuf.Int64Value min = 1;
    google.protobuf.Int64Value max = 2;
}

enum MetadataFilterFieldName {
    METADATA_FILTER_FIELD_NAME_UNSPECIFIED = 0;
    METADATA_FILTER_FIELD_NAME_APPLICATION_NAME = 1;
    METADATA_FILTER_FIELD_NAME_SUBSYSTEM_NAME = 2;
    METADATA_FILTER_FIELD_NAME_SERVICE_NAME = 3;
    METADATA_FILTER_FIELD_NAME_OPERATION_NAME = 4;
}

message FilterFieldValue {
    google.protobuf.StringValue value_name = 1;
    google.protobuf.Int32Value count = 2;
}

message MetadataFilter {
    MetadataFilterFieldName metadata_field = 1;
    repeated google.protobuf.StringValue values = 2;
}

message TagFilter {
    google.protobuf.StringValue tag_name = 1;
    repeated google.protobuf.StringValue values = 2;
}

message MetadataFilterField {
    MetadataFilterFieldName metadata_field = 1;
    repeated FilterFieldValue values = 2;
}

message TagFilterField {
    google.protobuf.StringValue tag_name = 1;
    repeated FilterFieldValue values = 2;
}

enum TraceGraphMetric {
    TRACE_GRAPH_FIELD_UNSPECIFIED = 0;
    TRACE_GRAPH_FIELD_TRACE_COUNT = 1;
    TRACE_GRAPH_FIELD_DURATION = 2;
}

enum GraphAggregationType {
    GRAPH_AGGREGATION_TYPE_UNSPECIFIED = 0;
    GRAPH_AGGREGATION_TYPE_MIN = 1;
    GRAPH_AGGREGATION_TYPE_MAX = 2;
    GRAPH_AGGREGATION_TYPE_COUNT = 3;
    GRAPH_AGGREGATION_TYPE_AVERAGE = 4;
    GRAPH_AGGREGATION_TYPE_SUM = 5;
}

message TracingGraph {
    TraceGraphMetric metric = 1;
    MetadataFilterField group_by_field = 2;
    GraphAggregationType aggregation_type = 3;
    google.protobuf.Int32Value bucketSizeMillis = 4;
}

message TracingQueryDefinition {
    TraceQueryTimeRange time_range = 1;
    TraceQueryLatency latency_range = 2;
    repeated MetadataFilter metadata_filters = 3;
    repeated TagFilter tag_filters = 4;
    repeated google.protobuf.Int32Value teams = 5;
    google.protobuf.StringValue text_filter = 6;
    google.protobuf.Int32Value size = 7;
    google.protobuf.Int32Value filter_size = 8;
    TracingGraph graph = 9;
}

message TracingQuery {
    google.protobuf.StringValue id = 1;
    TracingQueryDefinition query = 2;
}
